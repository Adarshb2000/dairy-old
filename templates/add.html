{% extends "layout.html" %}

{% block title %}
Add Animal
{% endblock %}

{% block main %}
<style>
    .hidden {
        display: none;
    }
    .bold {
        font-weight: bold;
    }
</style>


<form method="POST" class="needs-validation" novalidate id="form_employee">

    <!-- Tag Number Card -->
    <div class="card col-md-6 col-lg-6 mx-auto p-0" id="information">
        <div class="card-header text-center text-white bg-dark">
            <h5>Add a new Tag</h5>
        </div>
        <div class="card-body p-3">
            <div class="form-group border border-dark p-3">
                <div class="row">
                    <div class="col-6">
                        <div class="d-grid gap-2">
                            <button type="button" id="animal_1" onclick="animal_change(1)" class="btn btn-secondary border border-dark">Cow</button>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="d-grid gap-2">
                            <button type="button" id="animal_0" onclick="animal_change(0)" class="btn btn-secondary border border-dark">Buff</button>
                        </div>
                    </div>
                <input type="text" name="animal_category" class="hidden">
                </div><br>
                <div class="alert alert-primary">
                    Tag Number
                </div>
                <div class="form-inline">
                    <label for="TagNumber">टैग संख्या डेल &nbsp;</label>
                    <input type="number" name="TagNumber" min="1" id="TagNumber" required aria-describedby="animal" class="form-control">
                    <div class="invalid-feedback">
                        कृपया मान्य टैग नंबर दर्ज करें।
                    </div>
                </div>
            </div>
            <div class="form-group border border-dark p-3">
                <div class="alert alert-primary">
                    Date Bought and bought from (खरीदी की तारीख तथा किससे खरीदा)
                </div>
                <div class="form-inline">
                    <label for="BoughtDate">खरीदी हुई तिथि का चयन करें &nbsp;</label>
                    <input id="BoughtDate" name="BoughtDate" type="date" required class="form-control">&nbsp;
                    <!-- <input type="text" id="voice_date" class="form-control"> -->
                    <div class="invalid-feedback">
                        कृपया एक मान्य तिथि प्रविष्ट करें।
                    </div>
                </div><br>
                <div class="form-inline">
                    <label for="BoughtFrom">किससे खरीदा उसका नाम लिखें &nbsp;</label>
                    <input id="BoughtFrom" name="BoughtFrom" type="text" required class="form-control">
                    <div class="invalid-feedback">
                        कृपया एक मान्य नाम दर्ज करें।
                    </div>
                </div><br>
                <div class="form-inline">
                    <label for="VehicleNumber">वाहन संख्या दर्ज करें &nbsp;</label>
                    <input id="VehicleNumber" name="VehicleNumber" type="number" min="1" class="form-control">
                    <div class="invalid-feedback">
                        कृपया एक मान्य नाम दर्ज करें।
                    </div>
                </div>
            </div>
        </div>
        <!-- <div class="card-footer">
            <div class="row">
                <div class="col-6">
                    <a href="/" type="button" class="btn btn-block btn-danger">Exit</a>
                </div>
                <div class="col-6">
                    <button type="button" class="btn btn-block btn-primary" onclick="card_show(2)">Next</button>
                </div>
            </div>
        </div> -->

    <!-- Pregnancy Card -->

        <!-- <div class="card-header text-center text-white bg-dark">
            <h5>Add a new Tag</h5>
        </div> -->
        <div class="card-body p-3">
            <div class="border border-dark p-3" id="pregnancy_form">
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <div>
                        <h5 class="alert-heading text-center">Pregnancy <strong>1</strong></h5><hr>
                        <div class="form-inline">
                            <label class="bold"> उठी &nbsp;</label>
                            <input type="date" name="UthiDate" class="form-control">&nbsp;
                        </div><br>
                        <div class="form-inline">
                            <label class="bold"> पड़ा number &nbsp;</label>
                            <input type="number" min="1" name="BullNumber" class="form-control">&nbsp;
                        </div><hr>
                        <div class="form-inline">
                            <label class="bold" style="color: green; font-weight: bold;">Test Date &nbsp;</label>
                            <input type="date" name="TestDate" class="form-control">
                        </div><br>
                        
                        <div class="form-inline">
                            <label class="bold" style="color: green; font-weight: bold;">Doctor &nbsp;</label>
                            <input type="text" name="DoctorName" class="form-control">
                        </div><hr>
                    </div>
                    <div class="btn btn-outline-success text-middle mx-auto d-grid gap-2" onclick="doctor_confirm(1)">
                        <label for="DoctorConfirm_"><input type="checkbox" class="custom-control-input" name="DoctorConfirm_" onchange="event.preventDefault()" data-main-option="false">Doctor Confirm</label>
                    </div><div class="hidden">
                        <input type="text" name="DoctorConfirm" class="hidden" value="0">
                        <hr>
                        <div class="form-inline">
                            <label class="bold" style="color: green; font-weight: bold;">Months &nbsp;</label>
                            <input type="number" min="0" step="0.5" name="PregnancyStart" class="form-control">
                        </div><hr>
                        <div class="form">
                            <label class="bold">हुराई &nbsp;</label>
                            <input type="date" name="MilkStop" class="form-control">
                        </div><hr>
                        <div class="form">
                            <label class="bold">ब्याही &nbsp;</label>
                            <input type="date" name="DeliveryDate" class="form-control">&nbsp;
                            <select name="Gender" class="form-control">
                                <option value="-1" selected hidden>पड़ा/पड़िया</option>
                                <option value="1">पड़ा</option>
                                <option value="0">पड़िया</option>
                            </select>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            </div><hr>
            <div class="d-grid gap-2">
                <button type="button" class="btn btn-primary" onclick="pregnancy_add()">Add another detail</button>
            </div>
        </div>
        <!-- <div class="card-footer">
            <div class="row">
                <div class="col-6">
                    <button type="button" class="btn btn-block btn-secondary" onclick="card_show(2)">Back</button>
                </div>
                <div class="col-6">
                    <button type="submit" class="btn btn-block btn-success">Submit</button>
                </div>
            </div>
        </div> -->
    <!-- </div> -->

    <!-- Milk History Card -->

    <!-- <div class="card col-md-6 col-lg-6 mx-auto p-0" id="milk_history"> -->
        <!-- <div class="card-header text-center text-white bg-dark">
            <h5>Add a new Tag</h5>
        </div> -->
        <div class="card-body p-3">
            <div class="form-group border border-dark p-3" id="milk_history_form">
                <div class="alert alert-primary">
                    Milk History (दूध का रिकॉर्ड)
                </div>
                <!-- <div class="form-inline">
                    <label for="MilkHistoryVoiceInput">Enter Line Number, Milk, date &nbsp;</label>
                    <input type="text" id="MilkHistoryVoiceInput" class="form-control">
                    <div class="invalid-feedback">
                        Require a Line number.
                    </div>
                </div><hr> -->
                <div class="form-inline">
                    <label for="LineNumber">L.N. &nbsp;</label>
                    <input type="number" id="LineNumber" min="1" class="form-control yo">
                    <div class="invalid-feedback">
                        Require a Line number.
                    </div>
                </div><hr>
                <div class="form-inline">
                    <label for="Milk">Milk &nbsp;</label>
                    <input type="number" id="Milk" min="0" step="0.25" class="form-control yo">
                    <div class="invalid-feedback">
                        Require a Milk amount.
                    </div>
                </div><hr>
                <div class="form-inline">
                    <label for="MilkDate">Date &nbsp;</label>
                    <input type="date" id="MilkDate" class="form-control yo">
                    <div class="invalid-feedback">
                        Require a Date.
                    </div>
                </div><hr>
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-success" onclick="add()">Add</button>
                  </div><br>
                <table class="table table-hover hidden">
                    <thead>
                        <tr>
                            <th scope="col">L.N.</th>
                            <th scope="col">Milk</th>
                            <th scope="col">Date</th>
                        </tr>
                    </thead>
                    <tbody id="table_body"></tbody>
                </table>
                <button type="button" class="btn btn-secondary br-btn" disabled onclick="edit_changes()">Edit</button>
                <button type="button" class="btn btn-danger br-btn" disabled onclick="delete_row()">Delete</button>
            </div>
        </div>
        <div class="card-body p-3">
            <div class="form-group border border-dark p-3" id="milk_history_form">
                <div class="alert alert-primary">
                    Diseases (बीमारी)
                </div>
                <!-- <div class="form-inline">
                    <label for="MilkHistoryVoiceInput">Enter Line Number, Milk, date &nbsp;</label>
                    <input type="text" id="MilkHistoryVoiceInput" class="form-control">
                    <div class="invalid-feedback">
                        Require a Line number.
                    </div>
                </div><hr> -->
                <div class="form-inline">
                    <label for="Vaccine">Vaccine &nbsp;</label>
                    <input type="text" id="Vaccine"class="form-control">
                    <div class="invalid-feedback">
                        Require a Vaccine.
                    </div>
                </div><hr>
                
                <div class="form-inline">
                    <label for="VaccineDate">Date &nbsp;</label>
                    <input type="date" id="VaccineDate" class="form-control">
                    <div class="invalid-feedback">
                        Require a Date.
                    </div>
                </div><hr>
                <div class="form-inline">
                    <label for="DiseaseDoctor">Doctor &nbsp;</label>
                    <input type="text" id="DiseaseDoctor" class="form-control">
                    <div class="invalid-feedback">
                        Require a Doctor.
                    </div>
                </div><hr>
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-success" onclick="add()">Add</button>
                  </div><br>
                <table class="table table-hover hidden">
                    <thead>
                        <tr>
                            <th scope="col">L.N.</th>
                            <th scope="col">Milk</th>
                            <th scope="col">Date</th>
                        </tr>
                    </thead>
                    <tbody id="table_body"></tbody>
                </table>
                <button type="button" class="btn btn-secondary br-btn" disabled onclick="edit_changes()">Edit</button>
                <button type="button" class="btn btn-danger br-btn" disabled onclick="delete_row()">Delete</button>
            </div>
        </div>
        <div class="card-footer">
            <div class="row">
                <div class="col-6">
                    <a href="/" class="btn btn-block btn-danger">Back</a>
                </div>
                <div class="col-6">
                    <button type="submit" class="btn btn-block btn-success">Submit</button>
                </div>
            </div>
        </div>
    </div>


</form>
<p id="test"></p>



<script>

    // Tag Script
    function animal_change(which)
    {
        document.getElementById('animal_' + String(which)).classList.toggle('btn-success', true);
        document.getElementById('animal_' + String(which)).classList.toggle('btn-secondary', false);
        document.getElementById('animal_' + String(Number(!which))).classList.toggle('btn-success', false);
        document.getElementById('animal_' + String(Number(!which))).classList.toggle('btn-secondary', true);
        document.getElementsByName('animal_category')[0].value = (which == 1) ? 'Cow': 'Buff';
        document.getElementById('TagNumber').focus();
    }
    /*-----------------------------------------------------------------------------------*/


    // Milk history Script
    var items = ['LineNumber', 'Milk', 'MilkDate'];
    var selected_elements = [];

    function add_automatically() {
        items.forEach((item) => {
            
        })
    }

    function add() {
        
        var add_row = true;

        // Checking Items validity
        items.forEach((item) => {
            item = document.getElementById(item);
            if (!item.value){
                add_row = false;
                item.setCustomValidity('invalid');
            }
        });
        if (!add_row) {
            document.getElementById('milk_history_form').classList.toggle('was-validated'); 
            return;
        }

        // All valid
        document.getElementById('milk_history_form').classList.remove('was-validated'); 

        // Creating row
        var row = document.createElement('tr');

        // First column (number)
        var td = document.createElement('td');        

        items.forEach((item) => {
            var inp = document.createElement('input');
            inp.name = item;
            elem = document.getElementById(item);
            inp.setAttribute('value', elem.value);
            inp.classList = 'col-3 btn p-0';
            if (item === 'MilkDate') {
                inp.classList.replace('col-3', 'col-10');
            }
            inp.setAttribute('readonly', true);
            column = document.createElement('td');
            column.appendChild(inp);
            row.appendChild(column);
            elem.value = '';
        });

        row.addEventListener('click', (event) => {
            var elem = event['path'][1];
            if (elem.children.length != 3) {
                elem = event['path'][2];
            }
            if (selected_elements.includes(elem)){
                elem.classList.remove('bg-primary');
                selected_elements.splice(selected_elements.indexOf(elem), 1);
            }
            else {
                selected_elements.push(elem);
                elem.classList.add('bg-primary');
            }
            if (selected_elements.length == 0) {
                Array.prototype.filter.call(document.getElementsByClassName('br-btn'), (btn) => {
                    btn.setAttribute('disabled', true);
                });
            }
            else {
                Array.prototype.filter.call(document.getElementsByClassName('br-btn'), (btn) => {
                    btn.removeAttribute('disabled');
                });
            }

        });

        document.getElementsByTagName('tbody')[0].appendChild(row);
        if (document.getElementsByTagName('table')[0].children.length > 0) {
            document.getElementsByTagName('table')[0].classList.remove('hidden');
        }
        document.getElementById(items[0]).focus();
    }

    function edit_changes() {
        Array.prototype.filter.call(selected_elements, (elem) => {
            Array.prototype.filter.call(elem.children, (child) => {
                child.children[0].removeAttribute('readonly');
            });
        });
    }

    function delete_row() {
        Array.prototype.filter.call(selected_elements, (elem) => {
            elem.remove()
        });
        selected_elements = [];
        Array.prototype.filter.call(document.getElementsByClassName('br-btn'), (btn) => {
            btn.setAttribute('disabled', true);
        });
        if (document.getElementsByTagName('table')[0].children.length < 1) {
            document.getElementsByTagName('table')[0].classList.add('hidden');
        }
    }

    /*-----------------------------------------------------------------------------------*/



    // Pregnancy Script

    var division;
    window.onload = ()=>{
        division = document.getElementById('pregnancy_form').firstElementChild.cloneNode(true);
    }

    function doctor_confirm(elem) {
        var DC = document.getElementsByName('DoctorConfirm_')[elem - 1];
        var x = document.getElementsByName('DoctorConfirm')[elem - 1];
        x.value = (x.value == "0") ? "1" : "0";
        DC.checked = !DC.checked;
        DC.parentElement.parentElement.classList.toggle('btn-outline-success', !DC.checked);
        DC.parentElement.parentElement.classList.toggle('btn-success', DC.checked);
        DC.parentElement.parentElement.nextSibling.classList.toggle('hidden');
    }

    // window.onload = ()=>{setInterval(()=>{console.log(document.getElementsByName('DoctorConfirm')[0].value)}, 100)}

    var number_o_pregnancy = 1;

    function pregnancy_add() {
        number_o_pregnancy += 1;

        var parent_div = document.getElementById('pregnancy_form');

        var div = division.cloneNode(true);
        div.children[0].children[0].children[0].innerText = String(number_o_pregnancy);
        div.children[1].removeAttribute('onclick');
        div.children[1].setAttribute('onclick', 'doctor_confirm(' + String(number_o_pregnancy) + ')')
        
        parent_div.appendChild(div);

    }


    /*-----------------------------------------------------------------------------------*/

    (function () {
        'use strict';
        window.addEventListener('load', function () {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function (form) {
                form.addEventListener('submit', (event) => {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                        card_show(1);
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
    

    function card_show(number)
    {
        //document.getElementsByClassName('collapse.show')[0].classList.replace('collapse.show', 'collapse');
        //document.getElementsByClassName('card')[number - 1].classList.replace('collapse', 'collapse.show');
    }

</script>


{% endblock %}